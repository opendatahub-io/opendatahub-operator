---
name: Build and Push Feature Branch Custom Catalog
env:
  BUNDLE_IMG: quay.io/${{ secrets.QUAY_ORG }}/opendatahub-operator:${GITHUB_REF##*/}
  CATALOG_IMG: quay.io/${{ secrets.QUAY_ORG }}/opendatahub-operator-catalog:${GITHUB_REF##*/}
on:
  push:
    branches:
      - "feature-**"
permissions:
  pull-requests: read
  checks: read
jobs:
  build-and-push-feature-branch-custom-catalog:
    runs-on: ubuntu-latest
    timeout-minutes: 60
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Login to quay.io
        run: |
          podman login -u ${{ secrets.QUAY_ID }} -p ${{ secrets.QUAY_TOKEN }} quay.io
      - name: Build Feature Branch Catalog
        run: |
          make catalog-build -e CATALOG_IMG=${{ env.CATALOG_IMG }} -e BUNDLE_IMG=${{ env.BUNDLE_IMG }}
      - name: Push Feature Branch Catalog to quay.io
        run: |
          make catalog-push -e CATALOG_IMG=${{ env.CATALOG_IMG }}