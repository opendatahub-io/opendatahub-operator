apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: federate-prometheus
  namespace: {{ .MonNamespace }}
  labels:
    monitoring.rhobs/stack: odh-cmo-ms
spec:
  selector:
    matchLabels:
      app: prometheus
  endpoints:
    - port: web
      interval: 30s
      scheme: https
      tlsConfig:
        serverName: prometheus-k8s.monitoring.svc
        caFile: /etc/prometheus/ca/service-ca.crt
      bearerTokenFile: /var/run/secrets/kubernetes.io/serviceaccount/token
      honorLabels: true
      path: /federate
      params:
        match[]:
          - '{__name__= "haproxy_backend_http_responses_total"}'
          - '{__name__= "controller_runtime_reconcile_total"}'
          - '{__name__= "container_cpu_usage_seconds_total"}'
          - '{__name__= "container_memory_rss"}'
          - '{__name__= "kubelet_volume_stats_used_bytes"}'
          - '{__name__= "kubelet_volume_stats_capacity_bytes"}'
          - '{__name__= "kube_pod_container_status_waiting_reason"}'
          - '{__name__= "kube_pod_container_status_restarts_total"}'
          - '{__name__= "kube_pod_container_status_terminated_reason"}'
          - '{__name__= "openshift_build_status_phase_total"}'
          - '{__name__= "kube_statefulset_replicas"}'
