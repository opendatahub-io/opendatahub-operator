apiVersion: monitoring.rhobs/v1
kind: ServiceMonitor
metadata:
  name: rhoai-cmo
  namespace: {{ .MonNamespace }}
  labels:
    monitoring.rhobs/stack: rhoai-cmo-ms
    team: rhods # should we update to rhoai with SRE?
spec:
  selector:
    matchLabels:
      app.kubernetes.io/managed-by: observability-operator
  endpoints:
  - authorization:
      credentials:
        key: token
        name: prometheus-secret
    tlsConfig:
      serverName: prometheus-k8s.openshift-monitoring.svc
      ca:
        configMap:
          key: service-ca.crt
          name: openshift-service-ca.crt
    honorLabels: true
    params:
      'match[]':
          - '{__name__= "rhods_total_users"}'
          - '{__name__= "rhods_active_users"}' # do we still use this one ??
          - '{__name__= "rhods_aggregate_availability"}'
          - ALERTS{alertname!="DeadManSnitch", alertstate="firing"}
    port: https  # here is to use rhods-monitor-federation from old stack
    scheme: https
    path: "/federate"
    scrapeTimeout: 10s
    interval: 30s
  namespaceSelector:
    matchNames:
      - {{ .MonNamespace }}