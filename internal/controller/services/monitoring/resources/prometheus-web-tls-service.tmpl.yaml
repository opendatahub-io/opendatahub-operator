---
apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-web-tls-ca
  namespace: {{.Namespace}}
  labels:
    platform.opendatahub.io/part-of: monitoring
  annotations:
    service.beta.openshift.io/inject-cabundle: "true"
---
# This Service definition provides a minimal spec to handle fresh installations gracefully:
# 1. The 'prometheus-operated' Service is created and managed by the MonitoringStack Operator
# 2. We add the serving-cert-secret-name annotation to trigger OpenShift's service serving
#    cert controller to generate TLS certificates
# 3. This manifest is applied using Server-Side Apply (SSA), which merges this definition
#    with the MonitoringStack-created Service without conflicts
# 4. The minimal spec (empty ports, ClusterIP type) ensures the Service passes validation
#    if applied before MonitoringStack creates it, preventing transient errors on fresh installs
# 5. When MonitoringStack reconciles, it updates the spec with the actual port configuration
# 6. Each controller (MonitoringStack Operator and ODH Operator) manages different fields,
#    allowing them to coexist without conflicts via SSA field ownership
apiVersion: v1
kind: Service
metadata:
  name: prometheus-operated
  namespace: {{.Namespace}}
  annotations:
    service.beta.openshift.io/serving-cert-secret-name: prometheus-operated-tls
spec:
  ports: []
  type: ClusterIP
