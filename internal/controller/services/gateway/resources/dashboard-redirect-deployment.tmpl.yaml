apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{.DashboardRedirectName}}
  namespace: {{.DashboardRedirectNamespace}}
  labels:
    app: {{.DashboardRedirectName}}
    {{.PartOfLabelKey}}: {{.PartOfGatewayConfig}}
spec:
  replicas: 2
  selector:
    matchLabels:
      app: {{.DashboardRedirectName}}
  template:
    metadata:
      labels:
        app: {{.DashboardRedirectName}}
        {{.PartOfLabelKey}}: {{.PartOfGatewayConfig}}
    spec:
      containers:
      - name: nginx
        image: {{.DashboardRedirectImage}}
        command:
        - /usr/libexec/s2i/run
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        volumeMounts:
        - name: redirect-config
          mountPath: /opt/app-root/etc/nginx.default.d/redirect.conf
          subPath: redirect.conf
        resources:
          requests:
            cpu: 50m
            memory: 64Mi
          limits:
            cpu: 200m
            memory: 128Mi
        securityContext:
          allowPrivilegeEscalation: false
          runAsNonRoot: true
          capabilities:
            drop:
            - ALL
          seccompProfile:
            type: RuntimeDefault
      volumes:
      - name: redirect-config
        configMap:
          name: {{.DashboardRedirectConfigName}}
